// Google Maps script for Developer's Custom Fields
// Contributed by adriantoll
// Be careful of center (in this script) / centre (DCF form field IDs)
/*global google *//*global slt_cf_gmaps */// Set up an array for multiple maps and markers
function write_markers(e){var t="";for(var n in slt_cf_maps[e].markers)t+=slt_cf_maps[e].markers[n];t=t.replace(/\)\(/g,"|").replace(/\(/g,"").replace(/\)/g,"").replace(/ /g,"");console.log(t)}function add_marker(e,t){if(slt_cf_maps[e].map._slt_cf_input_map===!1)var n=new google.maps.Marker({map:slt_cf_maps[e].map,position:t});else{var n=new google.maps.Marker({draggable:!0,map:slt_cf_maps[e].map,position:t,title:"Drag to move, click to delete"});slt_cf_maps[e].marker_total++;n.id=slt_cf_maps[e].marker_total;slt_cf_maps[e].markers[n.id]=n.position.toString();write_markers(e);google.maps.event.addListener(n,"click",function(t){delete slt_cf_maps[e].markers[n.id];this.setMap(null);write_markers(e)});google.maps.event.addListener(n,"dragend",function(t){slt_cf_maps[e].markers[n.id]=t.latLng.toString();write_markers(e)})}}function slt_cf_gmap_init(e,t,n,r,i,s,o,u){o==="hybrid"?o=google.maps.MapTypeId.HYBRID:o==="satellite"?o=google.maps.MapTypeId.SATELLITE:o==="terrain"?o=google.maps.MapTypeId.TERRAIN:o=google.maps.MapTypeId.ROADMAP;i=i.replace(" ","");i=i.split(",");i=new google.maps.LatLng(i[0],i[1]);var a={center:i,mapTypeId:o,scrollwheel:!1,zoom:s};slt_cf_maps[e]=[];slt_cf_maps[e].map=new google.maps.Map(document.getElementById(e),a);slt_cf_maps[e].map._slt_cf_mapname=e;t==="input"?slt_cf_maps[e].map._slt_cf_input_map=!0:slt_cf_maps[e].map._slt_cf_input_map=!1;if(n){slt_cf_maps[e].markers=[];slt_cf_maps[e].marker_total=0;typeof r!="array"&&(r=[r]);if(r.length>0)for(var f in r){var l=r[f].split(",");l=new google.maps.LatLng(l[0],l[1]);add_marker(e,l)}}if(t==="input"){slt_cf_maps[e].doubleClick=!1;google.maps.event.addListener(slt_cf_maps[e].map,"dblclick",function(t){slt_cf_maps[e].doubleClick=!0;window.setTimeout(function(){slt_cf_maps[e].doubleClick=!1},250)});google.maps.event.addListener(slt_cf_maps[e].map,"click",function(t){window.setTimeout(function(){slt_cf_maps[e].doubleClick||add_marker(e,t.latLng)},250)});google.maps.event.addListener(slt_cf_maps[e].map,"bounds_changed",function(){document.getElementById(this._slt_cf_mapname+"_zoom").value=this.getZoom();document.getElementById(this._slt_cf_mapname+"_centre_latlng").value=this.getCenter().toString().slice(1,-1).replace(" ","");document.getElementById(this._slt_cf_mapname+"_bounds_sw").value=this.getBounds().getSouthWest().toString().slice(1,-1).replace(" ","");document.getElementById(this._slt_cf_mapname+"_bounds_ne").value=this.getBounds().getNorthEast().toString().slice(1,-1).replace(" ","")});if(jQuery().autocomplete){var c=new google.maps.Geocoder,h=jQuery("#"+e+"_bounds_sw").val().split(","),p=jQuery("#"+e+"_bounds_ne").val().split(","),d=new google.maps.LatLng(h[0],h[1]),v=new google.maps.LatLng(p[0],p[1]);slt_cf_maps[e].map.geocodeBounds=new google.maps.LatLngBounds(d,v);jQuery(document).ready(function(t){t("#"+e).after('<p class="gmap-address"><label for="'+e+'_address">'+slt_cf_gmaps.geocoder_label+':</label> <input type="text" id="'+e+'_address" name="'+e+'_address" value="" class="regular-text" /></p>');t("#"+e+"_address").autocomplete({source:function(n,r){c.geocode({address:n.term,bounds:slt_cf_maps[e].map.getBounds()},function(e,n){n===google.maps.GeocoderStatus.OK?r(t.map(e,function(e){return{label:e.formatted_address,value:e.formatted_address,latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()}})):console.log("Geocode was not successful for the following reason: "+n)})},select:function(t,r){var i=new google.maps.LatLng(r.item.latitude,r.item.longitude);slt_cf_maps[e].map.panTo(i);n&&add_marker(e,i)}})})}}typeof u!="undefined"&&window[u]&&window[u](slt_cf_maps[e].map)}var slt_cf_maps=[];jQuery(document).ready(function(e){e("div.gmap_input").length&&e("div.gmap_input").each(function(){var t,n;t=e(this).attr("id");e("input.gmap_toggle_display").length&&e("input.gmap_toggle_display").change(function(){e(this).hasClass("yes")?e("#"+t+"_wrapper").slideDown("fast",function(){n=slt_cf_maps[t].map.getCenter();google.maps.event.trigger(slt_cf_maps[t].map,"resize");slt_cf_maps[t].map.setCenter(n)}):e("#"+t+"_wrapper").slideUp()})})});